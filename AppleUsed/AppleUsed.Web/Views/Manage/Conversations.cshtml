
@using AppleUsed.Web.Views.Manage
@model AppleUsed.Web.Models.ViewModels.ConversationListViewModel
@{
    ViewData["Title"] = "Сообщения";
    ViewData.AddActivePage(ManageNavPages.Messages);
}

<div class="col-lg-12">
    @{
        foreach (var item in Model.Conversations)
        {
            string contactId = "";
            try
            {
                contactId = item.Messages.Where(x => x.SenderId != Model.UserId).LastOrDefault().SenderId;
            }
            catch { }

            try
            {
                if (String.IsNullOrEmpty(contactId))
                {
                    contactId = item.Messages.Where(x => x.ReceiverId != Model.UserId).LastOrDefault().ReceiverId;
                }
            }
            catch { }


            @if (item.Messages.Count > 0)
            {
                <div class="row">
                    <div>Номер объявления: <a asp-action="AdDetails" asp-controller="Ad" asp-route-id="@item.AdId"><b>@item.AdId</b></a></div>
                    <div class="col-sm-3">
                        <p>
                            От:
                            <a href="#">
                                @contactId
                            </a>
                        </p>
                    </div>

                    <div class="col-sm-9">
                        <p class="_last_message">


                            @if (@item.Messages.LastOrDefault().Message.Length < 50)
                            {
                                <a asp-controller="Chat"
                                   asp-action="ConversationByAdIdAndContactId"
                                   asp-route-adId="@item.AdId"
                                   asp-route-contactId="@contactId"
                                   style="color:white">
                                    <span>
                                        @item.Messages.LastOrDefault().Message
                                    </span>
                                </a>
                            }
                            else
                            {
                                <a asp-controller="Chat"
                                   asp-action="ConversationByAdIdAndContactId"
                                   asp-route-adId="@item.AdId"
                                   asp-route-contactId="@contactId"
                                   style="color:white">
                                    <span>
                                        @item.Messages.LastOrDefault().Message.Substring(0, 50) ...
                                    </span>
                                </a>
                            }
                            
                        </p>
                    </div>

                    <div class="col-md-3 col-md-offset-6">
                        <span>
                            @item.Messages.Last().CreatedAt
                        </span>
                    </div>

                </div>
                <hr />
                }
            }
        }
    </div>

